{% extends 'panel/index.html' %}

{% block content %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        #chatbox { width: auto; height: 400px; border: 1px solid #ccc; padding: 10px; overflow-y: auto; }
        .user, .bot { margin: 5px 0; }
        .user { text-align: right; color: blue; }
        .bot { text-align: left; color: green; }

        input{
        width:100%;
        height:50px;
        border: 2px solid #4CAF50; /* Green border */
        border-radius: 5px; /* Rounded corners */
        padding: 10px;

        }
        .btn{
           float:right;

        }
        .pb-0{
          padding:10px;
        }
        h3{

          font-family:Roboto;
        }
        .chat-input-container {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.chat-input-container input {
    flex: 1; /* Input takes full available width */
    height: 50px;
    border: 2px solid #4CAF50;
    border-radius: 5px;
    padding: 10px;
}

.chat-input-container .btn {
    height: 50px;
    padding: 0 20px;
    border-radius: 5px;
}
    </style>

<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-title text-center">
            <br>

        </div>



<div class="card-body">
    <center>
<h5 class="mb-0">SERA AI</h5>
        </center>
<div id="chatbox"></div>
   <div class="chat-input-container">
    <input type="text" id="user_input" placeholder="Type a message..." autofocus>
    <button class="btn btn-success" onclick="sendMessage()">Send</button>
</div>
<script>
   function sendMessage() {
    var userMessage = $("#user_input").val().trim();
    if (userMessage === "") return;

    $("#chatbox").append("<div class='user'><b>You:</b> " + userMessage + "</div>");
    $("#user_input").val("");

    $.ajax({
        url: "", // Ensure this points to your Django chatbot endpoint
        type: "POST",
        data: { message: userMessage, csrfmiddlewaretoken: '{{ csrf_token }}' },
        success: function(response) {
            var botMessage = response.response.replace(/\n/g, "<br>");
            $("#chatbox").append("<div class='bot'><b>SERA:</b> " + botMessage + "</div>");
            $("#chatbox").scrollTop($("#chatbox")[0].scrollHeight);
        },
        error: function() {
            $("#chatbox").append("<div class='bot'><b>SERA:</b> Error: Unable to get response.</div>");
        }
    });
}

$(document).ready(function () {
    $("#user_input").keypress(function (e) {
        if (e.which === 13 && !e.shiftKey) {
            sendMessage();
            return false;
        }
    });
});
</script>
</div>
    </div>
</div>

{% endblock %}
