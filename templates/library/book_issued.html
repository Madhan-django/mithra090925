{% extends 'adminpanel/index.html' %}

{% block content %}
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<div class="wlsm-main-header card col">
    <div class="school_header">
        <h1 class="h3 text-center">
            <i class="fa fa-graduation-cap text-light"></i>
            {{ skool }}
            <small class="wlsm_text_secondary">{{ year }}</small>
        </h1>
    </div>

    <div class="mt-3 text-center wlsm-section-heading-block">
        <span class="wlsm-section-heading-box">
            <span class="wlsm-section-heading">
                Issued Books
            </span>
        </span>
    </div>
</div>

<div class="col-11">
    <div class="container">
        <div class="row">
            <div class="col-sm">
                <form id="addstudform" data-section-url="{% url 'ajax_load_section' %}" data-student-url="{% url 'ajax_load_student' %}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}

                    <div class="form-group">
                        <label for="id_book_title">Book Title:</label>
                        {{ form.book_title }}
                    </div>

                    <div class="form-group">
                        <label for="id_sclass">Class:</label>
                        <select name="sclass" required id="id_sclass" class="form-control">
                            <option value="" selected>---------</option>
                            {% for opt in lib_class %}
                            <option value="{{ opt.id }}">{{ opt.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="id_section">Section:</label>
                        <select name="section" required id="id_section" class="form-control">
                            <option value="">--------</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="id_issued_to">Student:</label>
                        <select name="issued_to" required id="id_issued_to" class="form-control">
                            <option value="">--------</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="id_issued_quantity">Issued Quantity:</label>
                        {{ form.issued_quantity }}
                    </div>

                    <div class="form-group">
                        <label for="id_issued_date">Date:</label>
                        {{ form.issued_date }}
                    </div>

                    <div class="form-group">
                        <label for="id_return_date">Return Date:</label>
                        {{ form.return_date }}
                    </div>

                    <div class="form-group">
                        <label for="id_status">Status:</label>
                        {{ form.status }}
                    </div>

                    <div class="form-group">
                        <label for="id_acd_year">Academic Year:</label>
                        {{ form.acd_year }}
                    </div>

                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("#id_sclass").change(function() {
            var url = $("#addstudform").attr("data-section-url");
            var classId = $(this).val();
            $.ajax({
                url: url,
                data: {
                    'Class_Id': classId
                },
                success: function(data) {
                    $("#id_section").html(data);
                }
            });
        });

        $("#id_section").change(function() {
            var url = $("#addstudform").attr("data-student-url");
            var secsId = $(this).val();

            $.ajax({
                url: url,
                data: {
                    'SecsId': secsId
                },
                success: function(data) {
                    $("#id_issued_to").html(data);
                }
            });
        });
    });
</script>
{% endblock %}
