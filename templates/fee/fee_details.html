{% extends 'panel/index.html' %}

{% block content %}
<style>
/* ===== Global Styling ===== */
body, label, select, input, button {
    font-family: 'Roboto', sans-serif !important;
}

/* ===== Card Styling ===== */
.card {
    border-radius: 20px;
    box-shadow: 0px 4px 15px rgba(0,0,0,0.15);
    overflow: hidden;
}

/* ===== Title Bar with Badge ===== */
.card-title {
    background: linear-gradient(135deg, #1a73e8, #0056d6);
    padding: 6px 0; /* Reduced padding */
    border-radius: 20px 20px 0 0;
    text-align: center;
}
.card-title h5 {
    margin: 0;
    font-size: 20px; /* Smaller font */
    color: white;
}
.card-title h5 span.badge {
    background: #fff;
    color: #000;
    padding: 4px 10px; /* Badge padding */
    font-size: 14px;
    border-radius: 10px;
}

/* ===== Buttons ===== */
.btn-info {
    background: linear-gradient(135deg, #1a73e8, #0056d6) !important;
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 6px 15px;
}
.btn-danger {
    background: linear-gradient(135deg, #ff5b5b, #cc0000) !important;
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 6px 15px;
}
.btn-success {
    background: linear-gradient(135deg, #28a745, #1c7c31) !important;
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 6px 15px;
}
.btn-primary {
    background: linear-gradient(135deg, #007bff, #0056d2) !important;
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 6px 15px;
}

/* ===== Table Styling ===== */
.table {
    border-radius: 15px;
    overflow: hidden;
}
.table th, .table td {
    vertical-align: middle !important;
    text-align: center;
}
.table th {
    font-size: 13px;      /* Smaller font */
    padding: 4px 8px;     /* Reduced padding */
    height: 30px;         /* Reduced header height */
}
.table td {
    font-size: 13px;      /* Row font size */
    padding: 5px 8px;
}
.table-dark th {
    background-color: #212529 !important;
    color: white;
}

/* ===== Text Alignment ===== */
.text-end {
    text-align: right;
    padding-bottom: 10px;
}

/* ===== Form Controls ===== */
select.form-control, input.form-control {
    border-radius: 10px !important;
}

/* ===== Pagination Styling ===== */
.pagination-container {
    display: flex;
    justify-content: center;
    margin-top: 20px;
}
.pagination .page-item .page-link {
    border-radius: 10px;
    padding: 5px 10px;
}
.pagination .page-item.active .page-link {
    background-color: #1a73e8 !important;
    border-color: #0056d6 !important;
    color: white;
}
.pagination .page-item.disabled .page-link {
    color: #6c757d;
}
</style>

<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <!-- Title with Badge -->
        <div class="card-title">
            <h5><span class="badge">Fee Details</span></h5>
        </div>

        <!-- New Fee Button -->
        <div class="text-end p-3">
            <a href="{% url 'addindfee' %}" class="btn btn-info">New Fee</a>
        </div>

        <!-- Search Form -->
        <div class="col-md align-right px-3">
            <form id="myForm" method="POST" action="" class="form-inline">
                {% csrf_token %}
                <table class="table border-0 mb-0">
                    <tr>
                        <td>
                            <select name="searchby" id="searchby" class="form-control">
                                <option value="studname">Student Name</option>
                                <option value="admn_no">Admission No</option>
                                <option value="cclass">Class</option>
                                <option value="status">Status</option>
                            </select>
                        </td>
                        <td>
                            <input class="form-control" type="search" placeholder="Search" name="searched" required>
                        </td>
                        <td>
                            <button type="button" id="changeUrlsearch" class="btn btn-primary mx-2">Search</button>
                            <button type="button" id="changeUrldownload" class="btn btn-success mx-2">Download</button>
                            <a href="{% url 'invoices' %}" class="btn btn-danger mx-2">Clear</a>
                        </td>
                    </tr>
                </table>
            </form>
        </div>

        <!-- Fee Table -->
        <div class="card-body">
            {% if data %}
            <table class="table table-responsive">
                <thead class="table-dark text-center">
                    <tr>
                        <th>Invoice</th>
                        <th>Invoice No</th>
                        <th>Student Name</th>
                        <th>Class</th>
                        <th>Amount</th>
                        <th>Due Amount</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody class="text-center">
                    {% for frm in data %}
                    <tr>
                        <td>{{frm.fee_cat.invoice_title}}</td>
                        <td>{{frm.invoice_no}}</td>
                        <td>{{frm.stud_name.first_name}} {{frm.stud_name.last_name}}</td>
                        <td>{{frm.class_name.name}}</td>
                        <td>{{frm.fee_cat.fee_amount}}</td>
                        <td>{{frm.due_amt}}</td>
                        <td>{{frm.status}}</td>
                        <td>
                            <div class="d-flex align-items-center gap-1 justify-content-center">
                                <form action="{% url 'addfeereciept' frm.id %}" method="post" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-success btn-sm">
                                        <i class="ri-money-rupee-circle-line"></i> Pay
                                    </button>
                                </form>
                                <div class="dropdown">
                                    <button type="button" class="btn btn-info p-1 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                                        <i class="ri-more-2-line"></i>
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="{% url 'updateindfee' frm.id %}">
                                            <i class="ri-pencil-line me-1"></i> Edit
                                        </a>
                                        {% if request.user.groups.all.0.name == "Admin" or request.user.groups.all.0.name == "superadmin" %}
                                        <a class="dropdown-item" href="{% url 'delindfee' frm.id %}">
                                            <i class="ri-delete-bin-2-line me-1"></i> Delete
                                        </a>
                                        <a class="dropdown-item" href="{% url 'updateindfee_cat' frm.id %}">
                                            <i class="ri-swap-2-line me-1"></i> Change
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="alert alert-danger" role="alert">
                No Record available to Show
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Pagination -->
<nav aria-label="Page navigation" class="pagination-container">
  <ul class="pagination">
    {% if data.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ data.previous_page_number }}">Previous</a>
      </li>
    {% endif %}

    {% for num in data.paginator.page_range %}
        {% if data.number == num %}
          <li class="page-item active">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
          </li>
        {% else %}
          <li class="page-item">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
          </li>
        {% endif %}
    {% endfor %}

    {% if data.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ data.next_page_number }}">Next</a>
      </li>
    {% endif %}
  </ul>
</nav>

<!-- Scripts -->
<script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
$(document).ready(function() {
    $("#changeUrlsearch").click(function() {
        $("#myForm").attr("action", "{% url 'invoice_search' %}");
        $("#myForm").submit();
    });
    $("#changeUrldownload").click(function() {
        $("#myForm").attr("action", "{% url 'invoices_download' %}");
        $("#myForm").submit();
    });
    $("#myForm").on("keypress", function(e) {
        if (e.which === 13) {
            e.preventDefault();
            $("#changeUrlsearch").click();
        }
    });
});
</script>
{% endblock %}
