{% extends 'panel/index.html' %}
{% block content %}

<style>
body, h1, h3, h4, h5, label, input, select, textarea, button {
    font-family: 'Roboto', sans-serif;
}

/* CARD STYLING */
.card {
    border-radius: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.10);
    padding-bottom: 15px;
}

/* TITLE BAR */
.card-title {
    background: linear-gradient(90deg, #005C97, #363795);
    padding: 2px 0 !important;
    border-radius: 20px 20px 0 0;
    text-align: center;
}
.card-title h5 {
    margin: 0;
    font-size: 17px;
    font-weight: 500;
}
.card-title span.badge {
    background: #f8f9fa;
    color: #000;
    font-size: 13px;
    padding: 4px 10px;
    border-radius: 6px;
}

/* 2Ã—2 MATRIX */
.row-matrix {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 15px;
}
.col-matrix { flex: 1; min-width: 48%; }

/* FLOATING LABEL */
.form-floating-custom { position: relative; margin-bottom: 18px; }
.form-floating-custom input,
.form-floating-custom select,
.form-floating-custom textarea {
    width: 100%;
    padding: 14px 12px 6px 12px;
    border: 1px solid #bbb;
    border-radius: 10px;
    font-size: 15px;
    background-color: white;
}
.form-floating-custom textarea { min-height: 120px !important; }
.form-floating-custom label {
    position: absolute;
    top: -10px;
    left: 14px;
    background: white;
    padding: 0 6px;
    font-size: 13px;
    color: #444;
    pointer-events: none;
    z-index: 2;
}

/* SELECT2 FIX */
.select2-container .select2-selection--single {
    height: 50px !important;
    padding-top: 10px;
    border: 1px solid #bbb !important;
    border-radius: 10px !important;
}
.select2-selection__rendered { padding-top: 5px !important; }

/* BUTTONS */
.btn-primary {
    background: linear-gradient(135deg, #009ffd, #2a2a72);
    border: none;
    padding: 10px 30px;
    font-size: 15px;
    border-radius: 10px;
    transition: 0.3s;
}
.btn-danger {
    background: linear-gradient(135deg, #ff4e50, #c31432);
    border: none;
    padding: 10px 30px;
    font-size: 15px;
    border-radius: 10px;
}

/* ALIGN RIGHT */
.align-right { text-align: right; padding: 15px; }

/* Disabled fields background */
#id_aoc_other:disabled,
input[readonly], select[disabled], textarea[readonly] {
    background: #eee !important;
    pointer-events: none;
}

/* SECTION HEADINGS */
h6 { font-weight: 600; color: #007bff; margin-bottom: 8px; }
</style>


<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-title text-center">
            <h5><span class="badge">{{ title }}</span></h5>
        </div>

        <div class="card-body">
            <form method="post" enctype="multipart/form-data" id="addform"
                  data-section-url="{% url 'ajax_load_section' %}"
                  data-student-url="{% url 'ajax_load_students' %}">
                {% csrf_token %}

                {{ form.gschool }}
                {{ form.ac_year }}

                <!-- 1. REGISTER GRIEVANCE -->
                <h6>1. Register Grievance</h6><br>
                <div class="row-matrix">
                    <div class="col-matrix form-floating-custom">
                        {{ form.concern_person_name }}
                        {{ form.concern_person_name_hidden }}
                        <label>Concern Person Name</label>
                    </div>

                    <div class="col-matrix form-floating-custom">
                        {{ form.mobile }}
                        {{ form.mobile_hidden }}
                        <label>Mobile Number</label>
                    </div>
                </div>
                 <div class="row-matrix">
                    <div class="col-matrix form-floating-custom">
                        {{ form.complaint_date }}
                        {{ form.complaint_date_hidden }}
                        <label>Complaint Date</label>
                    </div>
                      <div class="col-matrix form-floating-custom">
                        {{ form.complaint_status }}
                        <label>Status</label>
                    </div>

                </div>
                  <div class="col-matrix form-floating-custom">
                        {{ form.complaint_received }}
                        {{ form.complaint_received_hidden }}

                  </div>


                <div class="form-floating-custom">
                    {{ form.detail }}
                    {{ form.detail_hidden }}
                    <label>Complaint Details</label>
                </div>
                   <!-- 2. RESPONSE -->
                <h6>2. Response</h6><br>
                <div class="form-floating-custom">
                    {{ form.principal_remark }}
                    <label>Principal Remark</label>
                </div>

                <div class="form-floating-custom">
                    {{ form.concern_person_remark }}
                    <label>Concern Person Remark</label>
                </div>

                <div class="form-floating-custom">
                    {{ form.act_details }}
                    <label>Action Details</label>
                </div>

                <div class="row-matrix">
                    <div class="col-matrix form-floating-custom">
                        {{ form.action_date }}
                        <label>Action Date</label>
                    </div>

                    <div class="col-matrix form-floating-custom">
                        {{ form.act_intimation_to_person }}
                        <label>Act Intimation to Person</label>
                    </div>
                </div>

                        {{ form.area_of_complaint }}

                {{ form.gsec }}
               {{ form.aoc_other }}
               {{form.stud_name}}
                {{form.gclass}}

                <div class="align-right">
                    <button type="submit" class="btn-primary">Update</button>
                    <button type="reset" class="btn-danger">Clear</button>
                </div>

            </form>
        </div>
    </div>
</div>

<!-- jQuery + Select2 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
$(document).ready(function(){

    // Load sections
    $("#id_gclass").change(function(){
        $.get($("#addform").data("section-url"), { "Class_Id": $(this).val() }, function(data){
            $("#id_gsec").html(data);
            $("#id_stud_name").html("<option value=''>Select Student</option>").trigger("change");
        });
    });

    // Load students
    $("#id_gsec").change(function(){
        $.get($("#addform").data("student-url"), {
            "class_id": $("#id_gclass").val(),
            "sec_id": $(this).val()
        }, function(data){
            $("#id_stud_name").html(data);
            $("#id_stud_name").select2({ width:"100%", allowClear:true });
        });
    });



    // AOC - Other enable/disable
    function toggleAOCOther(){
        let selected = $("#id_area_of_complaint").val();
        if(selected.toLowerCase() === "other" || selected.toLowerCase() === "others"){
            $("#id_aoc_other").prop("disabled", false);
        } else {
            $("#id_aoc_other").val("");
            $("#id_aoc_other").prop("disabled", true);
        }
    }
    toggleAOCOther();
    $("#id_area_of_complaint").change(toggleAOCOther);

    // Status color
    function colorStatus(){
        let status = $("#id_complaint_status option:selected").text().trim();
        let color = "#0066ff";  // Open
        if(status === "Pending") color = "#d00000";
        if(status === "In-progress") color = "#d4a100";
        if(status === "Resolved") color = "#0f9d58";
        $("#id_complaint_status").css({ "color": color, "font-weight":"bold", "background-color":"" });
    }
    colorStatus();
    $("#id_complaint_status").change(colorStatus);
});
</script>

{% endblock %}
