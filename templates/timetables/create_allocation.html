{% extends 'panel/index.html' %}
{% block content %}
<style>
  #id_teacher_school {
    display: none;
  }
</style>
<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-title text-center">
            <br>
            <h4>Teaching Allocation</h4>
        </div>
        <div class="card-body">

                <form id="allocateform" data-section-url="{% url 'ajax_load_secsub' %}" method="post">
                   {% csrf_token %}
                    <div class="row g-6">
                        <div class="col-md-6">
                            <div class="form-floating form-floating-outline">
                                <select name="teacher" class="form-select" required="" id="id_teacher">
                                  <option value="" selected="">---------</option>
                                  {% for teacher in stf %}
                                  <option value="{{teacher.id}}">{{teacher}}</option>
                                  {% endfor %}
                                </select>
                                <label for="id_teacher">Teacher</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating form-floating-outline">
                                <select name="cls"  class="form-select" required="" id="id_cls">
                                  <option value="" selected="">---------</option>
                                  {% for cl in clss %}
                                  <option value="{{cl.id}}">{{cl}}</option>
                                  {% endfor %}
                                 </select>
                                <label for="id_cls">Class</label>
                            </div>
                        </div>
                    </div><br>
                        <div class="row g-6">
                        <div class="col-md-6">
                            <div class="form-floating form-floating-outline">
                                <select name="section" class="form-select" required="" id="id_section">
                                  <option value="" selected="">---------</option>
                                </select>
                                <label for="id_section">Section</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating form-floating-outline">
                                <select name="subject"  class="form-select" required="" id="id_subject">
                                  <option value="" selected="">---------</option>
                                </select>
                                <label for="id_subject">Subject</label>
                            </div>
                        </div>
                        </div><br>
                        <div class="row g-6">
                        <div class="col-md-6">
                            <div class="form-floating form-floating-outline">
                                 <input type="number" name="hours_per_week" min="1" class="form-control" required="" id="id_hours_per_week">
                                <label for="id_hours_per_week">Workload per Week</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating form-floating-outline">
                                <div class="form-check form-check-primary mt-4">
                                    <input class="form-check-input" type="checkbox" value="" id="id_is_classteacher"  />
                                   <label class="form-check-label" for="id_is_classteacher">Is Class Teacher</label>
                               </div>

                            </div>
                        </div><br>
                         {{form.teacher_school}}
                        <div class="text-end">
                              <button type="submit" class="btn btn-primary">Save</button>
                              <button type="reset" class="btn btn-secondary">Clear</button>
                        </div>
                </form>
            </div>
        </div>
    </div>
<br><hr>
 <!-- Bordered Table -->
              <div class="card">
                <h5 class="card-header">Teachers Workload</h5>
                <div class="card-body">
                  <div class="table-responsive text-nowrap">
                    <table class="table table-bordered">
                      <thead>
                        <tr>
                            <th>Teacher Name</th>
                            <th>Class</th>
                            <th>Section</th>
                            <th>Subject</th>
                            <th>Hours Per week</th>
                            <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                      {% if data %}
                       {% for dt in data %}
                        <tr align="center">
                          <td align="left">
                            <i class="ri-user-2-line ri-22px text-danger me-4"></i
                            ><span class="fw-medium" >{{dt.teacher}}</span>
                          </td>
                          <td>{{dt.section.class_sec_name}}</td>
                          <td>{{dt.section}}</td>
                          <td>{{dt.subject}}</td>
                          <td>{{dt.hours_per_week}}</td>
                            <td>
                            <div class="dropdown">
                              <button
                                type="button"
                                class="btn p-0 dropdown-toggle hide-arrow"
                                data-bs-toggle="dropdown">
                                <i class="ri-more-2-line"></i>
                              </button>
                              <div class="dropdown-menu">
                                <a class="dropdown-item" href="{% url 'edit_teaching_allocation' dt.id %}"
                                  ><i class="ri-pencil-line me-1"></i> Edit</a
                                >
                                <a class="dropdown-item" href="{% url 'delete_teaching_allocation' dt.id %}"
                                  ><i class="ri-delete-bin-7-line me-1"></i> Delete</a
                                >
                              </div>
                            </div>
                          </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                         <tr>
                         <td colspan="6">No data found</td>
                         </tr>
                        {% endif %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!--/ Bordered Table -->



</table>
    </div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        $("#id_cls").change(function() {

            var url = $("#allocateform").attr("data-section-url");
            var classId = $(this).val();
            $.ajax({
                url: url,
                data: {
                    'Class_Id': classId
                },
                success: function(response) {
                    $("#id_section").html(response.sections_html);
                    $("#id_subject").html(response.subjects_html);
                }
            });
        });
    });
</script>
{% endblock %}

