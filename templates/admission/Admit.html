{% extends 'panel/index.html' %}
{% block content %}
<style>
/* === General Typography === */
body, h1, h3, h5, th, td, label, input, button, select {
    font-family: 'Roboto', sans-serif;
}

/* === Card Layout === */
  /* Card Layout - full width look */
    .col-lg-12.grid-margin.stretch-card {
        padding-left: 5px !important;
        padding-right: 5px !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }

    .card {
        border: none;

        border-radius: 12px;
        overflow: hidden;
        margin: 0;
    }

   /* ===== TITLE BAR (Gradient + Badge) ===== */
.card-title {
    background: linear-gradient(90deg, #005C97, #363795);
    padding: 4px  !important;
    border-radius: 20px 20px 0 0;
}

.card-title h5 {
    margin: 0;
    font-size: 17px;                  /* reduced */
    font-weight: 500;

}

.card-title span.badge {
    background: #f8f9fa;
    color: #000;
    font-size: 13px;                  /* reduced badge font */
    padding: 4px 20px;                /* reduced badge padding */
    border-radius: 6px;
}


h6 {
    font-weight: 600;
    color: #007bff;
}

.form-floating > label {
    color: #555;
}

.btn-primary {
    background: linear-gradient(90deg, #007bff, #00c6ff);
    border: none;
    font-weight: 500;
}

.btn-primary:hover {
    background: linear-gradient(90deg, #0069d9, #00aaff);
}

.btn-outline-secondary:hover {
    background-color: #6c757d;
    color: #fff;
}

img {
    border-radius: 10px;
    border: 2px solid #e3e3e3;
}

/* === Spacing Enhancements === */
.card-body {
    padding: 1.5rem 2rem;
}

hr {
    border-top: 2px solid #007bff33;
}
</style>

<div class="card">
    <div class="card-title text-center">
   <h5><span class="badge bg-light text-dark">New Student</span></h5>
    </div>
    <form class="card-body" id="addstudform"
          data-section-url="{% url 'ajax_load_section' %}"
          method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <br>

        <!-- === Personal Information === -->
        <h6>1. Personal Information</h6><br>
        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.first_name }}
                    <label for="id_first_name">First Name</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.last_name }}
                    <label for="id_last_name">Last Name</label>
                </div>
            </div>
        </div><br>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.gender }}
                    <label for="id_gender">Gender</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.dob_date }}
                    <label for="id_dob_date">Date of Birth</label>
                </div>
            </div>
        </div><br>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.religion }}
                    <label for="id_religion">Religion</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.caste }}
                    <label for="id_caste">Caste</label>
                </div>
            </div>
        </div><br>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.blood_group }}
                    <label for="id_blood_group">Blood Group</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.address }}
                    <label for="id_address">Address</label>
                </div>
            </div>
        </div><br>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.phone }}
                    <label for="id_phone">Phone</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.email }}
                    <label for="id_email">Email</label>
                </div>
            </div>
        </div><br>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.father_name }}
                    <label for="id_father_name">Father Name</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.mother_name }}
                    <label for="id_mother_name">Mother Name</label>
                </div>
            </div>
        </div><br>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.father_occupation }}
                    <label for="id_father_occupation">Father Occupation</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.mother_occupation }}
                    <label for="id_mother_occupation">Mother Occupation</label>
                </div>
            </div>
        </div>

        <hr class="my-4"/>
        <br>
        <!-- === School Info === -->
        <h6>2. School Info</h6><br>
        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.admn_no }}
                    <label for="id_admn_no">Admission No</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.admn_date }}
                    <label for="id_admn_date">Admission Date</label>
                </div>
            </div>
        </div><br>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.roll_no }}
                    <label for="id_roll_no">Roll No</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    <select name="class_name" class="form-control" required id="id_class_name">
                        <option value="">Select Class</option>
                        {% for ccls in cls %}
                        <option value="{{ ccls.id }}">{{ ccls }}</option>
                        {% endfor %}
                    </select>
                    <label for="id_class_name">Class Name</label>
                </div>
            </div>
        </div><br>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    <select name="secs" class="form-control" id="id_secs">
                        <option value="">Select Section</option>
                    </select>
                    <label for="id_secs">Section</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    {{ form.student_status }}
                    <label for="id_student_status">Status</label>
                </div>
            </div>
        </div><br>

        <div class="row g-3 align-items-center">
            <div class="col-md-6">
                <div class="form-floating form-floating-outline">
                    <input type="file" class="form-control" id="id_student_photo" name="student_photo" accept="image/*" />
                    <label for="id_student_photo">Profile Photo</label>
                </div>
            </div>
            <div class="col-md-6 text-center">
                <img id="photoPreview" src="#" alt="Preview" width="150" height="150" style="display:none;">
            </div>
        </div>

        {{ form.ac_year }}
        {{ form.school_student }}

        <div class="pt-4 text-center">
            <button type="submit" class="btn btn-primary me-2">Save</button>
            <button type="reset" class="btn btn-outline-secondary">Cancel</button>
        </div>
    </form>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
$(document).ready(function () {

    // === Dynamic Section Load ===
    $("#id_class_name").change(function () {
        var url = $("#addstudform").attr("data-section-url");
        var classId = $(this).val();
        $.ajax({
            url: url,
            data: { 'Class_Id': classId },
            success: function (data) {
                $("#id_secs").html(data);
            }
        });
    });

    // === Image Preview & File Validation ===
    $("#id_student_photo").on("change", function () {
        const file = this.files[0];
        if (file) {
            if (file.size > 120 * 1024) {
                alert("File size must be less than 120 KB!");
                $(this).val("");
                $("#photoPreview").hide();
                return;
            }
            const reader = new FileReader();
            reader.onload = function (e) {
                $("#photoPreview").attr("src", e.target.result).show();
            };
            reader.readAsDataURL(file);
        }
    });
});
</script>
{% endblock %}
