{% extends 'adminpanel/index.html' %}

{% block content %}
 <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<div class="wlsm-main-header card col">
	<div class="school_header">
		<h1 class="h3 text-center">
			<i class="fa fa-graduation-cap text-light"></i>
			{{skool}}<small class="wlsm_text_secondary">{{year}}</small>

					</h1>

    </div></div>

<div class="mt-3 text-center wlsm-section-heading-block">
			<span class="wlsm-section-heading-box">
				<span class="wlsm-section-heading">
					Attendance
				</span>
                {% if data %}
                <form action="{% url 'markholiday' %}"  method="" class="d-inline float-right">
              {% csrf_token %}

               <input type="submit" class="btn btn-sm btn-outline-light" value="Mark as Holiday">
          </form>
         <form action="{% url 'markallpresent' %}"  method="" class="d-inline float-right">
              {% csrf_token %}

               <input type="submit" class="btn btn-sm btn-outline-light" value="Mark all Present">
          </form>
                {% endif %}
			</span>

</div>


 <div class="row">
                <div class="col-sm">
                    <table class="table">
                        <tr>
                  <form id="addattendform"  data-section-url = "{% url 'ajax_load_section' %}" method="POST">

                      {% csrf_token %}

                    <div class="container">
                       <td> <label> Class :</label>{{form.aclass}}</td>

                    <td>
                       <label for="id_sec">Section:</label>
                           <select name="sec" required="" id="id_sec" class="form-control">
                              <option value="">--------</option>
                           </select>
                    </td>
                    <td>
                        <label> Attendance Date :</label>{{form.attndate}}
                    </td>
                     <td>
                       <br>
                       <button type="submit" class="btn btn-success float-right">Generate</button>
                     </td>



                  </form>
 </tr>
                        </table>
                </div>
                </div></div>

{% if data %}

<br><br>
<table class="table">
    <thead class="table-dark" align ="center">
    <tr>
      <th>First Name </th>
      <th>Class</th>
      <th>Section</th>
      <th>Date </th>
      <th>Status</th>
      <th>Actions</th>


    </tr>
  </thead>

  <tbody>


   {% for stud in data %}

    <tr align="center">

      <td>{{stud.student_name}}</td>
      <td>{{stud.aclass}}</td>
      <td>{{stud.sec}}</td>
      <td>{{stud.attndate}}</td>
      <td>{{stud.status}}</td>
        <td>
          <form id="addattendform" action="{% url 'markabsent' stud.id %}"  method="" class="d-inline">
              {% csrf_token %}

               <input type="submit" class="btn btn-danger btn-sm" value="A">
          </form>
          <form action="{% url 'markpresent' stud.id %}"  method="" class="d-inline">
              {% csrf_token %}

               <input type="submit" class="btn btn-success btn-sm" value="P">
          </form>


      </td>
    </tr>

   {% endfor %}
  </tbody>
</table>
{% else %}
    <div class="alert alert-danger" role="alert">
No Students Record  are available to Show
</div>

{% endif %}

<script type='text/javascript'  src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script type='text/javascript'>
    $(document).ready(function(){
    $("#id_aclass").change(function(){
    var url = $("#addattendform").attr("data-section-url");
     var classId = $(this).val();

       $.ajax({
        url: url,
        data: {
          'Class_Id': classId
        },
        success: function (data) {
          $("#id_sec").html(data);
        }
      });
         });

});
</script>

{% endblock %}